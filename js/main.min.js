var h=!1,l=!1,m=!1,n=2,p=!1,q=!1,r=!1,t=!1,u=!1,v=!1,w=!1,x,y=!0,z=0,A="",B="",C=!!window.showOpenFilePicker,D=void 0,E=[],F={};
class la{constructor(){this.g={}}register(a){let b=void 0;Array.isArray(a)?5<=Math.max.apply(null,a.map(c=>String(c).length))&&6<=a.length||80<=a.join(",").length||a.some(c=>"object"==typeof c)||0==a.length?b=a:(b=G(),this.g[`"${b}"`]=a):"string"==typeof a?(b=G(),this.g[`"${b}"`]=a.replace(/\\[^n\\]|\\$/g,"").replace(/\n|\\n/g,"\\n")):b=a;return b}replaceAll(a,b=!1){const c=Object.keys(this.g);for(let d=0;d<c.length;d++){const e=c[d],f=this.g[e];a=a.replace(e,()=>{if(Array.isArray(f))return b?JSON.stringify(f):
JSON.stringify(f).split(/^\[/).join("[").split(/,/).join(", ").split(/\]$/).join("]");if("string"==typeof f)return`"${f}"`})}return a}}
function ma(a){$("span.issue-error-num").text("\u30a8\u30e9\u30fc:"+a.g.length);$("span.issue-warning-num").text("\u8b66\u544a:"+a.h.length);0>=a.h.length&&0>=a.g.length?$("ul.issue-list").append("<li>\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093</li>"):(a.g.forEach(b=>{$("ul.issue-list").append($("<li>").append($("<img>").attr({src:"img/error.svg",alt:"",width:"19px",height:"19px"}),$("<p>").text(b[0])));b[1].addClass("stat-error")}),a.h.forEach(b=>{$("ul.issue-list").append($("<li>").append($("<img>").attr({src:"img/warning.svg",
alt:"",width:"19px",height:"19px"}),$("<p>").text(b[0])));b[1].addClass("stat-warning")}))}function H(a,b,c){a.h.push([b,c])}function I(a,b,c){a.g.push([b,c])}class na{constructor(){this.g=[];this.h=[];$("ul.issue-list li").remove();$(".stat-warning,.stat-error").removeClass("stat-warning stat-error")}}
function G(){let a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");for(let b=0,c=a.length;b<c;b++)switch(a[b]){case "x":a[b]=Math.floor(16*Math.random()).toString(16);break;case "y":a[b]=(Math.floor(4*Math.random())+8).toString(16)}return a.join("")}function J(a=""){return null===a.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$")?!1:!0}window.addEventListener("beforeunload",a=>{h&&(a.preventDefault(),a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002")});
$(document).on("change keyup click","input,textarea,select",function(a){K();h=$(a.target).is("[ui]")?h:!0;$("#edit_state").toggleClass("changed",h)});window.addEventListener("load",function(){$('input[type="button"].generate_uuid').parents("div.type-uuid").find('input[type="text"]').val(G);K()});$(".separator").on("mousedown",function(){p?p&&=!1:p=!0});$(document).on("mouseup",function(){p=!1;$("html").css("cursor","");const a=$(".separator");a.prev().removeClass("drag-lock");a.next().removeClass("drag-lock")});
$(document).on("mousemove",function(a){if(p){$("html").css("cursor","e-resize");const c=$(".separator");c.prev().addClass("drag-lock");c.next().addClass("drag-lock");var b=$("html").width()-2;a=b-a.clientX;b-=a;c.next().css("flex-basis",a);c.prev().css("flex-basis",b)}});window.addEventListener("resize",function(){$("div.preview").css("display","");$("div.editor").css("flex-basis","");$("div.data_check").css("flex-basis","");z=5;L()});
$(document).on("click",function(a){$("details.open-more-info").attr("open")&&($(a.target).is("details.open-more-info>summary")&&(a.preventDefault(),a.stopPropagation()),$("details.open-more-info").prop("open",!1))});$("details.open-more-info").on("mouseenter mouseleave",function(a){$("details.open-more-info").prop("open",$(a.target).is(":hover"))});$("#show_help").on("click",function(){$("#page-help").fadeIn("fast");L()});$("#page-help").on("click",function(){L()});
function L(){switch(z){case 1:$("#help-content-1").fadeOut("fast");$("#help-content_2").slideToggle("fast");z++;break;case 2:$("#help-content_2").slideToggle("fast");$("#help-content-3").fadeIn("fast");z++;break;case 3:$("#help-content-3").fadeOut("fast");$("#page-help").hide();z=0;break;case 5:$("#help-content-1").hide();$("#help-content_2").hide();$("#help-content-3").hide();$("#page-help").hide();z=0;break;default:$("#help-content-1").fadeIn("fast"),z++}}
$("div#show-preview").on("click",function(){const a=$("div#show-preview");$("div.preview").slideToggle();a.toggleClass("active",!a.hasClass("active"))});$("#open-about").on("click",function(){$("div.page-about").removeClass("about-hide")});$("#close-about-btn").on("click",function(){$("div.page-about").addClass("about-hide")});$(".page-about").on("click",function(a){$(a.target).is(".page-about")&&$("div.page-about").addClass("about-hide")});
$(document).on("click",".tab-children:not(.selected)>input",function(){const a=$(this).attr("class");if("modules"==a||q&&"dependencies"==a||u&&"subpacks"==a){const b=$(this).parent(),c=b.index();$(`.${a}`+".tab-children").removeClass("selected");b.addClass("selected");$(`.${a}`+".tab-content-list>div").removeClass("selected-tab-content").eq(c).addClass("selected-tab-content")}});
$("#modules_add,#dependencies_add,#subpacks_add").on("click",function(){($(this).hasClass("modules")||u&&$(this).hasClass("subpacks")||q&&$(this).hasClass("dependencies"))&&M($(this).attr("class"));K()});
function M(a=""){var b=$(`.${a}`+".tab-body");const c=b.children("label").length;b.append($("<label>").addClass(`${a} tab-children invisible_Control`).append($("<input>").attr("type","button").addClass(a),$("<div>").addClass("tab-number").text(c),$("<div>").addClass("tab-underBar")));b.children("li:last-child").hide().show(150);a=$(`.${a}`+".tab-content-list");b=a.children("div:first-child").clone().removeClass("selected-tab-content");Array.prototype.forEach.call(b.find('input:not([type="button"])'),
d=>{d.value=d.defaultValue});Array.prototype.forEach.call(b.find("textarea"),d=>{d.value=d.defaultValue});a.append(b)}$("#modules-delete,#dependencies-delete,#subpacks-delete").on("click",function(a){const b=`.${$(this).attr("class")}`;($(this).hasClass("modules")||u&&$(this).hasClass("subpacks")||q&&$(this).hasClass("dependencies"))&&oa(b);K();a.stopPropagation()});
function oa(a=""){let b=$(a+".tab-children");if(!(""==a||1>=b.length)){$(a+".tab-children.selected").remove();$(a+".tab-content-list>.selected-tab-content").remove();b=$(a+".tab-children");a=$(a+".tab-content-list>div");var c=0;for(let d=0;d<b.length;d++){const e=b.eq(d),f=a.eq(d);0==d&&(e.addClass("selected"),f.addClass("selected-tab-content"));e.children("div.tab-number").text(c);c++}}}$("#author-add").on("click",function(){N();K()});
function N(a=""){$("div.authors_list").append($("<label>").addClass("author_name").append($("<div>").addClass("author_num").text($(".author_name").length),$("<input>").attr({type:"text",["class"]:"metadata_author",value:a})))}$("#author-delete").on("click",function(){$("div.authors_list>.author_name:last-child").remove();K()});$("#issue-control").on("click",function(){const a=$("div.issue-status-label svg");a.hasClass("close")?a.attr("class","open"):a.attr("class","close");$("div.issue_content").slideToggle()});
navigator.share&&($(".about-external-link .share").addClass("supported"),$("#page-share").on("click",async()=>{await navigator.share({title:"Manifest Generator",text:"Manifest Generator -manifest.json\u3092\u7c21\u5358\u306b\u4f5c\u6210\u30fb\u7de8\u96c6-",url:"https://toka7290.github.io/MCAddonSetupManager/"})}));
$(window).on("keydown",async function(a){if(!a.defaultPrevented&&a.ctrlKey)switch(a.key.toLowerCase()){case "s":a.stopPropagation();a.preventDefault();a.shiftKey?await O(!0):await O();break;case "o":a.stopPropagation(),a.preventDefault(),await P(await Q())}});
C?($(".file_load_button").removeClass("disabled"),$(".import_button").addClass("disabled"),$(".preview_control_child.save").removeClass("disabled"),$("#load_file").on("click",async()=>{P(await Q())}),$("#control_save").on("click",async()=>{O()}),$(window).on("focus",()=>{!h&&D&&R()})):($(".file_load_button").addClass("disabled"),$(".import_button").removeClass("disabled"),$(".preview_control_child.save").addClass("disabled"),$("#input-file").on("change",function(){S()}));
async function Q(){const a={multiple:!1,excludeAcceptAllOption:!1,types:[{description:"JSON",accept:{"application/json":[".json"]}}]};let b;try{b=await window.showOpenFilePicker(a)}catch(c){return}[D]=b;return await R()}async function R(){if(D)return await (await D.getFile()).text()}
async function O(a=!1){var b=B;let c;a||(c=D);if(!c)try{c=await window.showSaveFilePicker({excludeAcceptAllOption:!1,types:[{description:"JSON",accept:{"application/json":[".json"]}}]})}catch(e){return}const d=await c.createWritable();await d.write(b);await d.close();h=!1;$("#edit_state").toggleClass("changed",h);!a&&c&&(D=c)}
function S(){const a=$("#input-file").prop("files")[0],b=new FileReader;b.onload=function(){P(b.result)};try{b.readAsText(a)}catch(c){window.alert("\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306fmanifest.json\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002manifest.json\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),console.error("error:"+c)}}$(document).on("dragenter dragover",function(a){a.stopPropagation();a.preventDefault();$(".file-drop-zone").removeClass("hide")});
$(".file-drop-zone-pick").on("dragleave",function(a){a.stopPropagation();a.preventDefault();$(".file-drop-zone").addClass("hide")});$(document).on("drop",async function(a){h=!0;$(".file-drop-zone").addClass("hide");var b=a;a.originalEvent&&(b=a.originalEvent);b.stopPropagation();b.preventDefault();C?P(await b.dataTransfer.files[0].text()):($("#input-file").prop("files",b.dataTransfer.files),S())});
navigator.clipboard?($(".preview_control_child.copy").removeClass("disabled"),$("#control_copy").on("click",async function(){await navigator.clipboard.writeText(B);$("p#control_copy_text").text("Copied");setTimeout(function(){$("p#control_copy_text").text("Copy")},1E3)})):$(".preview_control_child.copy").addClass("disabled");$("#control_download").on("click",function(){$("<a></a>",{href:window.URL.createObjectURL(new Blob([B])),download:"manifest.json",target:"_blank"})[0].click()});
$("#control_simple").on("click",function(a){m=a.target.checked;T()});
function T(){$(".editor_element_group.editor_normal_mode").toggleClass("hide",m);$(".editor_element_group.editor_simple_mode").toggleClass("hide",!m);var a=$("#simple_pack_name");const b=a.val(),c=$("#simple_description"),d=c.val(),e=$("#header_pack_name").val(),f=$("#header_description").val();if(m){""==b&&""!=e&&a.val(e);""==d&&""!=f&&c.val(f);A=$(".modules.tab-content-list > div:nth-child(1) #modules_description").val();a="behavior";switch($(".modules.tab-content-list > div:nth-child(1) #modules_type").val()){case "resources":a=
"texture";break;case "world_template":a="world";break;case "skin_pack":a="skin"}$(`input[type="radio"][name="simple_type_child"][value="${a}"]`).prop("checked",!0)}else a.val(""),c.val("")}$("#control_compact").on("click",function(a){l=a.target.checked});$("#format_version").on("change",function(){n=Number($("#format_version").val())});$(document).on("click",'input[type="button"].generate_uuid',function(){$(this).parents("div.type-uuid").find('input[type="text"]').val(G);K()});
function K(){m&&pa();qa();ra();sa();y&&U();ta();B=ua();$("pre.language-json code.language-json").remove();$("pre.language-json").append($("<code>").addClass("language-json").text(B));var a=$("#header_pack_name").val();if(""==a)a="\u540d\u524d\u304c\u3042\u308a\u307e\u305b\u3093";else if(null!=a.match(/\\/g)){a=a.split("\\\\");var b="";for(var c=0;c<a.length;c++){var d=a[c].indexOf("\\n");1<=c&&(b+="\\\\");if(-1!=d){b+=`${a[c].slice(0,a[c].indexOf("\\n")-a[c].length)+"\u2026"}`;break}else b+=`${a[c]}`}a=
b}$("#card-title").text(a);d=$("#header_description").val();if(""==d)d="\u00a7c\u4e0d\u660e\u306a\u30d1\u30c3\u30af\u306e\u8aac\u660e";else if(null!=d.match(/\\/g)){b=a=0;c="";d=d.split("\\\\");for(let e=0;e<d.length;e++){do if(b++,a=d[e].indexOf("\\n",a+1),-1==a)break;while(3>b);1<=e&&(c+="\\\\");if(-1!=a){c+=`${d[e].slice(0,a+1-d[e].length)+"\u2026"}`;break}else c+=`${d[e]}`}d=c}$("#card-description").text(d);MCFormat.formatAll();Prism.highlightAll()}
function ta(){y=!1;"number"===typeof x&&window.clearTimeout(x);x=window.setTimeout(function(){y=!0;U()},500)}
function qa(){q=$("#dependencies_enable").is(":checked")||$("#dependencies_enable").is(":indeterminate");r=$("#capabilities_enable").is(":checked")||$("#capabilities_enable").is(":indeterminate");t=$("#metadata_enable").is(":checked")||$("#metadata_enable").is(":indeterminate");u=$("#subpacks_enable").is(":checked")||$("#subpacks_enable").is(":indeterminate");var a=$(".dependencies.tab-content-list div.value-element");q?(a.find("div.value-label").removeClass("disabled"),a.find("input").prop("disabled",
!1),""==$("#dependencies_uuid").val()?$("#dependencies_enable").prop("indeterminate",!0):$("#dependencies_enable").prop("indeterminate",!1)):(a.find("div.value-label").addClass("disabled"),a.find("input").prop("disabled",!0));a=$(".capabilities_list .value-element");r?(a.removeClass("disabled"),a.find("input").prop("disabled",!1),$("div.capabilities_list div input").is(":checked")?$("#capabilities_enable").prop("indeterminate",!1):$("#capabilities_enable").prop("indeterminate",!0)):(a.addClass("disabled"),
a.find("input").prop("disabled",!0));a=$(".metadata_list .value-element");t?(a.removeClass("disabled"),a.find("input").prop("disabled",!1),[0<$(".metadata_author").length?""!=$(".metadata_author").val():!1,""!=$("#metadata_url").val(),""!=$("#metadata_license").val()].some(b=>b)?$("#metadata_enable").prop("indeterminate",!1):$("#metadata_enable").prop("indeterminate",!0)):(a.addClass("disabled"),a.find("input").prop("disabled",!0));a=$(".subpacks.tab-content-list div.value-element");u?(a.find("div.value-label").removeClass("disabled"),
a.find("input").prop("disabled",!1),""==$("#subpacks_folder_name").val()&&""==$("#subpacks_name").val()?$("#subpacks_enable").prop("indeterminate",!0):$("#subpacks_enable").prop("indeterminate",!1)):(a.find("div.value-label").addClass("disabled"),a.find("input").prop("disabled",!0))}
function ra(){[".dependencies",".subpacks"].forEach((a,b)=>{V(a,[[q,u][b],[q,u][b],[q,u][b]&&1<$(a+".tab-children").length])});1<$(".author_name").length?$(".remove_author").removeClass("disabled").find("input").prop("disabled",!1):$(".remove_author").addClass("disabled").find("input").prop("disabled",!0)}
function V(a="",b=[0,0,0]){[".tab-body",".add-tab",".remove-tab"].forEach((c,d)=>{c=$(a+c);1==b[d]?c.removeClass("disabled").find("input").prop("disabled",!1):0==b[d]&&c.addClass("disabled").find("input").prop("disabled",!0)})}
function sa(){let a=Array.prototype.map.call($(".modules.tab-content-list > div #modules_type"),f=>f.value);v=a.some(f=>"world_template"==f);w=a.some(f=>"skin_pack"==f);$("#header_min_engine_version").toggleClass("disabled",v||w);$("#header_min_engine_version_input input").prop("disabled",v||w);$("#header_base_game_version").toggleClass("disabled",2<=n&&!v);$("#header_base_game_version_input input").prop("disabled",2<=n&&!v);$("#header_lock_template_options").prop("disabled",!v).parent().toggleClass("disabled",
!v);$("#header_pack_scope_label").toggleClass("disabled",v||w);$("#header_pack_scope").prop("disabled",v||w);let b=[!1,!1,!1,!1,!1,!1,!1,!1,!1];const c={data:0,resources:1,client_data:2,script:3,["interface"]:4,world_template:5,skin_pack:6,javascript:7,plugin:8};let d=v||w||a.some(f=>"resources"==f);E=[];for(let f=0;f<a.length;f++){const g=$(`.modules.tab-content-list > div:nth-child(${f+1})`),k=g.find(" #modules_type");b.forEach((wa,xa)=>{k.find(`option:nth-child(${xa+1})`).prop("disabled",wa)});
if(b[c[a[f]]]){var e=b.indexOf(!1);if(-1==e){E.push(f);continue}k.prop("selectedIndex",e);a[f]=k.val()}let W,X;(W=b)[X=c[a[f]]]||(W[X]=!0);e="script"==a[f]||"javascript"==a[f]||"plugin"==a[f];let Y,Z;(Y=b)[Z=c.script]||(Y[Z]=e);let aa,ba;(aa=b)[ba=c.javascript]||(aa[ba]=e);let ca,da;(ca=b)[da=c.plugin]||(ca[da]=e);let ea,fa;(ea=b)[fa=c.resources]||(ea[fa]=!0);let ha,ia;(ha=b)[ia=c.world_template]||(ha[ia]=!0);let ja,ka;(ja=b)[ka=c.skin_pack]||(ja[ka]=!0);g.find("#modules_language_label").toggleClass("disabled",
!e);g.find("#modules_language").prop("disabled",!e);g.find("#modules_entry_label").toggleClass("disabled",!e);g.find("#modules_entry").prop("disabled",!e);d&&b.fill(!0)}d?V(".modules",[!1,0,0]):V(".modules",[!0,b.some(f=>0==f),a.length-1])}
function U(){const a=new na;let b=$("#header_min_engine_version_major");var c=b.val();switch(n){case 1:(1<c||13<=Number($("#header_min_engine_version_minor").val()))&&H(a,"[Header:min engine version] \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30d0\u30fc\u30b8\u30e7\u30f31\u3067\u306f1.13\u3088\u308a\u4f4e\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3088\u308a\u9ad8\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30d0\u30fc\u30b8\u30e7\u30f32\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002",b.parent().find("input"));
break;case 2:1>=c&&13>Number($("#header_min_engine_version_minor").val())&&I(a,"[Header:min engine version] version1.12\u4ee5\u4e0b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002",b.parent().find("input")),1>=Number($("#header_base_game_version_major").val())&&13>Number($("#header_base_game_version_minor").val())&&I(a,"[Header:base game version] version1.12\u4ee5\u4e0b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002",$("#header_base_game_version_major").parent().find("input"))}b=
$("#header_pack_name");c=b.val();""==c?H(a,'[Header:name] \u540d\u524d\u304c\u7a7a\u3067\u3059\u3002\u540d\u524d\u304c\u7a7a\u306e\u5834\u5408\u3001"\u540d\u524d\u304c\u3042\u308a\u307e\u305b\u3093"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002',b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&I(a,'[Header:name] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',
b);b=$("#header_description");c=b.val();""==c?H(a,'[Header:description] \u8aac\u660e\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u8aac\u660e\u304c\u7a7a\u306e\u5834\u5408\u3001"\u4e0d\u660e\u306a\u30d1\u30c3\u30af\u306e\u8aac\u660e"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002',b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&I(a,'[Header:description] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',
b);b=$("#header_uuid");c=b.val();""==c?I(a,"[Header:uuid] UUID\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",b):J(c)||I(a,"[Header:uuid] \u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002",b);var d=$(".modules.tab-children").length;for(let f=0;f<d;f++){if(E.some(k=>k==f))continue;var e=f+1;b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_type`);let g=
b.val();null==g&&I(a,`[Modules:${f}:type] type\u304cnull\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002type\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,b);"javascript"!=g&&"plugin"!=g||H(a,`[Modules:${f}:type] "${g}"\u306f\u904e\u53bb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305ftype\u3067\u3059\u3002\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002"script"\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,
b);b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_description`);c=b.val();""==c?H(a,`[Modules:${f}:description] \u8aac\u660e\u304c\u3042\u308a\u307e\u305b\u3093\u3002`,b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&I(a,`[Modules:${f}:description] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,b);b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_uuid`);
c=b.val();""==c?I(a,`[Modules:${f}:uuid] UUID\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,b):J(c)||I(a,`[Modules:${f}:uuid] \u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002`,b);if("script"==g||"javascript"==g||"plugin"==g)b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_entry`),c=b.val(),""==c?I(a,`[Modules:${f}:entry] \u30d7\u30e9\u30a4\u30de\u30ea\u30d5\u30a1\u30a4\u30eb\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093`,
b):c.match(/\.js$/)||I(a,`[Modules:${f}:entry] \u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f .js \u306e\u62e1\u5f35\u5b50\u3092\u6301\u3063\u3066\u3044\u307e\u305b\u3093\u3002 \u30d7\u30e9\u30a4\u30de\u30ea\u30d5\u30a1\u30a4\u30eb\u306fJavaScript\u30d5\u30a1\u30a4\u30eb\u4ee5\u5916\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u305b\u3093\u3002`,b)}if(q)for(d=$(".dependencies.tab-children").length,e=0;e<d;e++)b=$(`div.dependencies.tab-content-list > div:nth-child(${e+1}) #dependencies_uuid`),
c=b.val(),""==c?I(a,`[Dependencies:${e}:uuid] UUID\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,b):J(c)||I(a,`[Dependencies:${e}:uuid] \u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002`,b);r&&($("#experimental_custom_ui").is(":checked")||$("#chemistry").is(":checked")||$("#raytracing").is(":checked")||H(a,"[Capabilities] \u4e00\u3064\u3082\u9805\u76ee\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",
$(".capabilities_list>input")));if(t){if(d=$("label.author_name").length)for(e=0;e<d;e++)b=$("input.metadata_author").eq(e),c=b.val(),""==c?H(a,`[Metadata:author:${e}] \u540d\u524d\u304c\u7a7a\u3067\u3059\u3002`,b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&I(a,`[Metadata:author:${e}] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u6d88\u53bb\u3059\u308b\u304b\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3057\u3066\u518d\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,
b);else H(a,"[Metadata:author] \u540d\u524d\u304c\u4e00\u3064\u3082\u3042\u308a\u307e\u305b\u3093\u3002",$("div.add_author"));b=$("#metadata_url");c=b.val();""==c?H(a,"[Metadata:url] URL\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&I(a,'[Metadata:url] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',
b);b=$("#metadata_license");c=b.val();""==c?H(a,"[Metadata:license] \u30e9\u30a4\u30bb\u30f3\u30b9\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&I(a,'[Metadata:license] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',b)}if(u)for(d=$(".subpacks.tab-children").length,
e=0;e<d;e++)c=$(`div.subpacks.tab-content-list > div:nth-child(${e+1})`),b=c.find("#subpacks_folder_name"),""==b.val()&&I(a,`[Subpacks:${e}:folder_name] \u30d5\u30a9\u30eb\u30c0\u30fc\u540d\u304c\u7a7a\u3067\u3059\u3002`,b),b=c.find("#subpacks_name"),c=b.val().toString(),""==c?I(a,`[Subpacks:${e}:name] \u540d\u524d\u304c\u7a7a\u3067\u3059\u3002`,b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&I(a,`[Subpacks:${e}:name] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,
b);ma(a)}
function va(a="",b=""){let c="\u6709\u52b9\u306ajson\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";if(""==a||""==b)return c;b=b.split(" ");var d=b.findIndex(f=>"line"==f),e=b.findIndex(f=>"position"==f);-1!=d?(b=parseInt(b[d+1],10),e=f=>{let g=0;for(let k=1;k<f;k++)g=a.indexOf("\n",g)+1;return g},d=e(b-1),e=e(b+1)-1,c+=`\n${b-1}~${b}\u884c\u3067\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n${a.substring(d,e)}`):-1!=e&&(b=b[e+1],d=a.lastIndexOf("\n",a.lastIndexOf("\n",b)-1)+1,e=
a.substr(0,d).match(/\n/g)?.length??1,c+=`\n${e}~${e+1}\u884c\u3067\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n${a.substring(d,a.indexOf("\n",b-1))}`);return c}
async function P(a=""){var b={};try{b=JSON.parse(a)}catch(g){if(a.match(/\/\*[\s\S]*?\*\/ | \/\/(?=.*)(?!.*(",|")).*/g)&&window.confirm(`${va(a,g.message)}\n\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u9664\u53bb\u3057\u3066\u518d\u8a66\u884c\u3057\u307e\u3059\u304b\uff1f\n`)){a=a.replace(/\/\*[\s\S]*?\*\/ | \/\/(?=.*)(?!.*(",|")).*/g,"");try{b=JSON.parse(a)}catch(k){window.alert(va(a,k.message)),console.error("error:"+k)}}else console.error("error:"+g)}if(b?.format_version)$("#format_version").val(b.format_version);
else if(b?.header?.modules){window.alert("\u53e4\u3044\u5f62\u5f0f(pack_manifest.json)\u304b\u3089\u5909\u63db\u3057\u307e\u3059\u3002");b=b.header;$("#header_pack_name").val(b?.name??"");$("#header_description").val(b?.description??"");$("#header_uuid").val(b?.pack_id??"");var c=(b?.packs_version??"1.0.0").split(".");$("#header_version_major").val(c?.[0]??1);$("#header_version_minor").val(c?.[1]??0);$("#header_version_patch").val(c?.[2]??0);if(null!=b.modules)for(c=0;c<b.modules.length;c++){0<c&&
M("modules");var d=b.modules[c];a=$(`.modules.tab-content-list > div:nth-child(${c+1})`);a.find("#modules_type").val(d?.type??"data");a.find("#modules_description").val(d?.description??"");var e=(d?.version??"1.0.0").split(".");a.find("#modules_version_major").val(e?.[0]??1);a.find("#modules_version_minor").val(e?.[1]??0);a.find("#modules_version_patch").val(e?.[2]??0);a.find("#modules_uuid").val(d?.uuid??"")}if(null!=b.dependencies)for($("#dependencies_enable").prop("checked",!0),c=0;c<b.dependencies.length;c++)0<
c&&M("dependencies"),a=b.dependencies[c],d=$(`div.dependencies.tab-content-list > div:nth-child(${c+1})`),d.find("#dependencies_uuid").val(a?.uuid??""),a=(a?.version??"1.0.0").split("."),d.find("#dependencies_version_major").val(a?.[0]??1),d.find("#dependencies_version_minor").val(a?.[1]??0),d.find("#dependencies_version_patch").val(a?.[2]??0);K();return}$("#header_pack_name").val(b.header?.name??"");$("#header_description").val(b.header?.description??"");$("#header_version_major").val(b.header?.version?.[0]??
1);$("#header_version_minor").val(b.header?.version?.[1]??0);$("#header_version_patch").val(b.header?.version?.[2]??0);$("#header_min_engine_version_major").val(b.header?.min_engine_version?.[0]??1);$("#header_min_engine_version_minor").val(b.header?.min_engine_version?.[1]??13);$("#header_min_engine_version_patch").val(b.header?.min_engine_version?.[2]??0);$("#header_uuid").val(b.header?.uuid??"");$("#header_platform_locked").prop("checked",b.header?.platform_locked??!1);$("#header_base_game_version_major").val(b.header?.base_game_version?.[0]??
1);$("#header_base_game_version_minor").val(b.header?.base_game_version?.[1]??13);$("#header_base_game_version_patch").val(b.header?.base_game_version?.[2]??0);$("#header_lock_template_options").prop("checked",b.header?.lock_template_options??!1);$("#header_pack_scope").val(b.header?.pack_scope??"none");if(b?.modules)for(a=0;a<b.modules.length;a++){0<a&&M("modules");e=b.modules[a];var f=$(`.modules.tab-content-list > div:nth-child(${a+1})`);f.find("#modules_type").val(e?.type??"data");f.find("#modules_description").val(e?.description??
"");f.find("#modules_version_major").val(e?.version?.[0]??1);f.find("#modules_version_minor").val(e?.version?.[1]??0);f.find("#modules_version_patch").val(e?.version?.[2]??0);f.find("#modules_uuid").val(e?.uuid??"");f.find("#modules_language").val(e?.language??"javascript");f.find("#modules_entry").val(e?.entry??"")}if(b?.dependencies)for($("#dependencies_enable").prop("checked",!0),a=0;a<b.dependencies.length;a++)0<a&&M("dependencies"),e=b.dependencies[a],f=$(`div.dependencies.tab-content-list > div:nth-child(${a+
1})`),f.find("#dependencies_uuid").val(e?.uuid??""),f.find("#dependencies_version_major").val(e?.version?.[0]??1),f.find("#dependencies_version_minor").val(e?.version?.[1]??0),f.find("#dependencies_version_patch").val(e?.version?.[2]??0);if(b?.capabilities){$("#capabilities_enable").prop("checked",!0);for(d of b.capabilities)switch(d){case "experimental_custom_ui":$("#experimental_custom_ui").prop("checked",!0);break;case "chemistry":$("#chemistry").prop("checked",!0);break;case "raytracing":$("#raytracing").prop("checked",
!0)}}if(b?.metadata){d=b.metadata;F=d?.generated_with;a=!1;if(d?.authors){for(c of d.authors)N(c);a||=!0}d?.url&&(a||=!0);$("#metadata_url").val(d?.url??"");d?.license&&(a||=!0);$("#metadata_license").val(d?.license??"");$("#metadata_enable").prop("checked",a)}if(b?.subpacks)for($("#subpacks_enable").prop("checked",!0),c=0;c<b.subpacks.length;c++)0<c&&M("subpacks"),d=b.subpacks[c],a=$(`div.subpacks.tab-content-list > div:nth-child(${c+1})`),a.find("#subpacks_folder_name").val(d?.folder_name??""),
a.find("#subpacks_name").val(d?.name??""),a.find("#subpacks_memory_tier").val(d?.memory_tier??0);T();K()}
function ua(){const a=new la;let b={};b.format_version=n;b.header={};b.header.name=a.register($("#header_pack_name").val());b.header.description=a.register($("#header_description").val());b.header.version=a.register([Number($("#header_version_major").val()),Number($("#header_version_minor").val()),Number($("#header_version_patch").val())]);b.header.uuid=$("#header_uuid").val();b.header.platform_locked=$("#header_platform_locked").is(":checked")?!0:void 0;v?(2<=n&&(b.header.base_game_version=a.register([Number($("#header_base_game_version_major").val()),
Number($("#header_base_game_version_minor").val()),Number($("#header_base_game_version_patch").val())])),b.header.lock_template_options=$("#header_lock_template_options").is(":checked")):w||(b.header.min_engine_version=a.register([Number($("#header_min_engine_version_major").val()),Number($("#header_min_engine_version_minor").val()),Number($("#header_min_engine_version_patch").val())]),b.header.pack_scope="none"!=$("#header_pack_scope").val()?$("#header_pack_scope").val():void 0);b.modules=[];var c=
$(".modules.tab-children").length;for(let g=0;g<c;g++)if(!E.some(k=>k==g)){var d=$(`.modules.tab-content-list > div:nth-child(${g+1})`),e=d.find("#modules_type").val();null!=e&&void 0!=e&&(b.modules[g]={},b.modules[g].type=e,b.modules[g].description=a.register(d.find("#modules_description").val()),b.modules[g].version=a.register([Number(d.find("#modules_version_major").val()),Number(d.find("#modules_version_minor").val()),Number(d.find("#modules_version_patch").val())]),b.modules[g].uuid=d.find("#modules_uuid").val(),
b.modules[g].language="script"==e||"javascript"==e?a.register(d.find("#modules_language").val()):void 0,b.modules[g].entry="script"==e||"javascript"==e||"plugin"==e?a.register(d.find("#modules_entry").val()):void 0)}if(q)for(b.dependencies=[],c=$(".dependencies.tab-children").length,d=0;d<c;d++)e=$(`div.dependencies.tab-content-list > div:nth-child(${d+1})`),b.dependencies[d]={},b.dependencies[d].uuid=e.find("#dependencies_uuid").val(),b.dependencies[d].version=a.register([Number(e.find("#dependencies_version_major").val()),
Number(e.find("#dependencies_version_minor").val()),Number(e.find("#dependencies_version_patch").val())]);r&&$("div.capabilities_list div input").is(":checked")&&(b.capabilities=[],$("#experimental_custom_ui").is(":checked")&&b.capabilities.push("experimental_custom_ui"),$("#chemistry").is(":checked")&&b.capabilities.push("chemistry"),$("#raytracing").is(":checked")&&b.capabilities.push("raytracing"));b.metadata={};if(t){const g=$("input.metadata_author");if((()=>{for(let k=0;k<g.length;k++)if(""!=
g.eq(k).val())return!0;return!1})())for(b.metadata.authors=[],c=0;c<g.length;c++)b.metadata.authors.push(a.register(g.eq(c).val()));""!=$("#metadata_url").val()&&(b.metadata.url=a.register($("#metadata_url").val()));""!=$("#metadata_license").val()&&(b.metadata.license=a.register($("#metadata_license").val()))}b.metadata.generated_with={};F["TokaTools-Manifest-Generator"]=Array.from((new Set([...(F["TokaTools-Manifest-Generator"]??[])])).add("1.8.0"));for(var f in F)b.metadata.generated_with[f]=a.register(F[f]);
if(u)for(b.subpacks=[],f=$(".subpacks.tab-children").length,c=0;c<f;c++)d=c+1,b.subpacks[c]={},e=$(`div.subpacks.tab-content-list > div:nth-child(${d})`),b.subpacks[c].folder_name=e.find("#subpacks_folder_name").val(),b.subpacks[c].name=a.register($(`div.subpacks.tab-content-list > div:nth-child(${d}) #subpacks_name`).val()),b.subpacks[c].memory_tier=Number(e.find("#subpacks_memory_tier").val());return a.replaceAll(JSON.stringify(b,void 0,l?void 0:"  "),l)}
function pa(){const a=$("#simple_pack_name").val();var b=$("#simple_description").val(),c=$("#header_pack_name"),d=$("#header_description");c.val(a);d.val(b);b=$("#header_uuid");""==b.val()&&(b.val(G()),h=!0);b=$(".modules.tab-children").length;for(c=0;c<b;c++){d=$(`.modules.tab-content-list > div:nth-child(${c+1})`);var e=d.find("#modules_type");let f="data",g="behavior";switch($('input[type="radio"][name="simple_type_child"]:checked').val()){case "behavior":f="data";g="behavior";break;case "texture":g=
f="resources";break;case "world":f="world_template";g="world template";break;case "skin":f="skin_pack",g="skin pack"}e.val()!=f&&(A="");e.val(f);e=d.find("#modules_description");""==A&&(e.val(`${[a.replace(/\u00a7.|\\n/g,""),g].filter(k=>k).join(" ")} module`),h=!0);d=d.find("#modules_uuid");""==d.val()&&(d.val(G()),h=!0)}};
