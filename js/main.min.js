var h=!1,l=!1,m=!1,n=2,p=!1,q=!1,r=!1,t=!1,u=!1,v=!1,w=!1,x=!1,y,z=!0,A=0,B="",C="",D=!!window.showOpenFilePicker,E=void 0,F=[],G={};const ma=["@minecraft/server","@minecraft/server-gametest","@minecraft/server-ui","@minecraft/server-admin","@minecraft/server-net"];
class na{constructor(){this.g={}}register(a){let b=void 0;Array.isArray(a)?5<=Math.max.apply(null,a.map(c=>String(c).length))&&6<=a.length||80<=a.join(",").length||a.some(c=>"object"==typeof c)||0==a.length?b=a:(b=H(),this.g[`"${b}"`]=a):"string"==typeof a?(b=H(),this.g[`"${b}"`]=a.replace(/\\[^n\\]|\\$/g,"").replace(/\n|\\n/g,"\\n")):b=a;return b}replaceAll(a,b=!1){const c=Object.keys(this.g);for(let d=0;d<c.length;d++){const e=c[d],f=this.g[e];a=a.replace(e,()=>{if(Array.isArray(f))return b?JSON.stringify(f):
JSON.stringify(f).split(/^\[/).join("[").split(/,/).join(", ").split(/\]$/).join("]");if("string"==typeof f)return`"${f}"`})}return a}}
function oa(a){$("span.issue-error-num").text(a.g.length);$("span.issue-warning-num").text(a.h.length);0>=a.h.length&&0>=a.g.length?$("ul.issue-list").append("<li>\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093</li>"):(a.g.forEach(b=>{$("ul.issue-list").append($("<li>").append($("<img>").attr({src:"./img/error.svg",alt:"",width:"24px",height:"24px"}),$("<p>").text(b[0])));b[1].addClass("stat-error")}),a.h.forEach(b=>{$("ul.issue-list").append($("<li>").append($("<img>").attr({src:"./img/warning.svg",
alt:"",width:"24px",height:"24px"}),$("<p>").text(b[0])));b[1].addClass("stat-warning")}))}function I(a,b,c){a.h.push([b,c])}function J(a,b,c){a.g.push([b,c])}class pa{constructor(){this.g=[];this.h=[];$("ul.issue-list li").remove();$(".stat-warning,.stat-error").removeClass("stat-warning stat-error")}}
function H(){let a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");for(let b=0,c=a.length;b<c;b++)switch(a[b]){case "x":a[b]=Math.floor(16*Math.random()).toString(16);break;case "y":a[b]=(Math.floor(4*Math.random())+8).toString(16)}return a.join("")}function K(a=""){return null===a.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$")?!1:!0}window.addEventListener("beforeunload",a=>{h&&(a.preventDefault(),a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002")});
$(document).on("change keyup click","input,textarea,select",function(a){L();h=$(a.target).is("[ui]")?h:!0;$("#edit_state").toggleClass("changed",h)});window.addEventListener("load",function(){$('input[type="button"].generate_uuid').parents("div.type-uuid").find('input[type="text"]').val(H);L()});$(".separator").on("mousedown",function(){q?q&&=!1:q=!0});$(document).on("mouseup",function(){q=!1;$("html").css("cursor","");const a=$(".separator");a.prev().removeClass("drag-lock");a.next().removeClass("drag-lock")});
$(document).on("mousemove",function(a){if(q){$("html").css("cursor","e-resize");const c=$(".separator");c.prev().addClass("drag-lock");c.next().addClass("drag-lock");var b=$("html").width()-2;a=b-a.clientX;b-=a;c.next().css("flex-basis",a);c.prev().css("flex-basis",b)}});window.addEventListener("resize",function(){$("div.preview").css("display","");$("div.editor").css("flex-basis","");$("div.data_check").css("flex-basis","");A=5;M()});
$(document).on("click",function(a){$("details.open-more-info").attr("open")&&($(a.target).is("details.open-more-info>summary")&&(a.preventDefault(),a.stopPropagation()),$("details.open-more-info").prop("open",!1))});$("details.open-more-info").on("mouseenter mouseleave",function(a){$("details.open-more-info").prop("open",$(a.target).is(":hover"))});$("#show_help").on("click",function(){$("#page-help").fadeIn("fast");M()});$("#page-help").on("click",function(){M()});
function M(){switch(A){case 1:$("#help-content-1").fadeOut("fast");$("#help-content_2").slideToggle("fast");A++;break;case 2:$("#help-content_2").slideToggle("fast");$("#help-content-3").fadeIn("fast");A++;break;case 3:$("#help-content-3").fadeOut("fast");$("#page-help").hide();A=0;break;case 5:$("#help-content-1").hide();$("#help-content_2").hide();$("#help-content-3").hide();$("#page-help").hide();A=0;break;default:$("#help-content-1").fadeIn("fast"),A++}}
$("div#show-preview").on("click",function(){const a=$("div#show-preview");$("div.preview").slideToggle();a.toggleClass("active",!a.hasClass("active"))});$("#open-about").on("click",function(){$("div.page-about").removeClass("about-hide")});$("#close-about-btn").on("click",function(){$("div.page-about").addClass("about-hide")});$(".page-about").on("click",function(a){$(a.target).is(".page-about")&&$("div.page-about").addClass("about-hide")});
$(document).on("click",".tab-children:not(.selected)>input",function(){const a=$(this).attr("class");if("modules"==a||r&&"dependencies"==a||v&&"subpacks"==a){const b=$(this).parent(),c=b.index();$(`.${a}`+".tab-children").removeClass("selected");b.addClass("selected");$(`.${a}`+".tab-content-list>div").removeClass("selected-tab-content").eq(c).addClass("selected-tab-content")}});
$("#modules_add,#dependencies_add,#subpacks_add").on("click",function(){($(this).hasClass("modules")||v&&$(this).hasClass("subpacks")||r&&$(this).hasClass("dependencies"))&&N($(this).attr("class"));L()});
function N(a=""){var b=$(`.${a}`+".tab-body");const c=b.children("label").length;b.append($("<label>").addClass(`${a} tab-children invisible_Control`).append($("<input>").attr("type","button").addClass(a),$("<div>").addClass("tab-number").text(c),$("<div>").addClass("tab-underBar")));b.children("li:last-child").hide().show(150);a=$(`.${a}`+".tab-content-list");b=a.children("div:first-child").clone().removeClass("selected-tab-content");Array.prototype.forEach.call(b.find('input:not([type="button"])'),
d=>{d.value=d.defaultValue});Array.prototype.forEach.call(b.find("textarea"),d=>{d.value=d.defaultValue});a.append(b)}$("#modules-delete,#dependencies-delete,#subpacks-delete").on("click",function(a){const b=`.${$(this).attr("class")}`;($(this).hasClass("modules")||v&&$(this).hasClass("subpacks")||r&&$(this).hasClass("dependencies"))&&qa(b);L();a.stopPropagation()});
function qa(a=""){let b=$(a+".tab-children");if(!(""==a||1>=b.length)){$(a+".tab-children.selected").remove();$(a+".tab-content-list>.selected-tab-content").remove();b=$(a+".tab-children");a=$(a+".tab-content-list>div");var c=0;for(let d=0;d<b.length;d++){const e=b.eq(d),f=a.eq(d);0==d&&(e.addClass("selected"),f.addClass("selected-tab-content"));e.children("div.tab-number").text(c);c++}}}$("#author-add").on("click",function(){O();L()});
function O(a=""){$("div.authors_list").append($("<label>").addClass("author_name").append($("<div>").addClass("author_num").text($(".author_name").length),$("<input>").attr({type:"text",["class"]:"metadata_author",value:a})))}$("#author-delete").on("click",function(){$("div.authors_list>.author_name:last-child").remove();L()});
let ra=new Animation(new KeyframeEffect(document.getElementsByClassName("preview-toggle-text")[0],[{transform:"rotate(0deg)"},{transform:"rotate(180deg)"},{transform:"rotate(360deg)"}],{duration:500,direction:"alternate",easing:"ease"}));document.getElementById("toggle-preview").addEventListener("click",()=>{document.getElementsByClassName("preview-ore-ui-card")[0].classList.toggle("hide");document.getElementsByClassName("preview-card")[0].classList.toggle("hide");p=!p;ra.play()});
document.getElementById("preview-ore-ui-summary").addEventListener("click",()=>{document.getElementById("preview-ore-ui-toggle").classList.toggle("close");document.getElementById("preview-ore-ui-details").classList.toggle("close")});$("#issue-control").on("click",function(){const a=$("div.issue-status-label svg");a.hasClass("close")?a.attr("class","open"):a.attr("class","close");$("div.issue_content").slideToggle()});
navigator.share&&($(".about-external-link .share").addClass("supported"),$("#page-share").on("click",async()=>{await navigator.share({title:"Manifest Generator",text:"Manifest Generator -manifest.json\u3092\u7c21\u5358\u306b\u4f5c\u6210\u30fb\u7de8\u96c6-",url:"https://toka7290.github.io/MCAddonSetupManager/"})}));
$(window).on("keydown",async function(a){if(!a.defaultPrevented&&a.ctrlKey)switch(a.key.toLowerCase()){case "s":a.stopPropagation();a.preventDefault();a.shiftKey?await P(!0):await P();break;case "o":a.stopPropagation(),a.preventDefault(),await Q(await R())}});
D?($(".file_load_button").removeClass("disabled"),$(".import_button").addClass("disabled"),$(".preview_control_child.save").removeClass("disabled"),$("#load_file").on("click",async()=>{Q(await R())}),$("#control_save").on("click",async()=>{P()}),$(window).on("focus",()=>{!h&&E&&S()})):($(".file_load_button").addClass("disabled"),$(".import_button").removeClass("disabled"),$(".preview_control_child.save").addClass("disabled"),$("#input-file").on("change",function(){T()}));
async function R(){const a={multiple:!1,excludeAcceptAllOption:!1,types:[{description:"JSON",accept:{"application/json":[".json"]}}]};let b;try{b=await window.showOpenFilePicker(a)}catch(c){return}[E]=b;return await S()}async function S(){if(E)return await (await E.getFile()).text()}
async function P(a=!1){var b=C;let c;a||(c=E);if(!c)try{c=await window.showSaveFilePicker({excludeAcceptAllOption:!1,types:[{description:"JSON",accept:{"application/json":[".json"]}}]})}catch(e){return}const d=await c.createWritable();await d.write(b);await d.close();h=!1;$("#edit_state").toggleClass("changed",h);!a&&c&&(E=c)}
function T(){const a=$("#input-file").prop("files")[0],b=new FileReader;b.onload=function(){Q(b.result)};try{b.readAsText(a)}catch(c){window.alert("\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306fmanifest.json\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002manifest.json\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),console.error("error:"+c)}}$(document).on("dragenter dragover",function(a){a.stopPropagation();a.preventDefault();$(".file-drop-zone").removeClass("hide")});
$(".file-drop-zone-pick").on("dragleave",function(a){a.stopPropagation();a.preventDefault();$(".file-drop-zone").addClass("hide")});$(document).on("drop",async function(a){h=!0;$(".file-drop-zone").addClass("hide");var b=a;a.originalEvent&&(b=a.originalEvent);b.stopPropagation();b.preventDefault();D?Q(await b.dataTransfer.files[0].text()):($("#input-file").prop("files",b.dataTransfer.files),T())});
navigator.clipboard?($(".preview_control_child.copy").removeClass("disabled"),$("#control_copy").on("click",async function(){await navigator.clipboard.writeText(C);$("p#control_copy_text").text("Copied");setTimeout(function(){$("p#control_copy_text").text("Copy")},1E3)})):$(".preview_control_child.copy").addClass("disabled");$("#control_download").on("click",function(){$("<a></a>",{href:window.URL.createObjectURL(new Blob([C])),download:"manifest.json",target:"_blank"})[0].click()});
$("#control_simple").on("click",function(a){m=a.target.checked;U()});
function U(){$(".editor_element_group.editor_normal_mode").toggleClass("hide",m);$(".editor_element_group.editor_simple_mode").toggleClass("hide",!m);var a=$("#simple_pack_name");const b=a.val(),c=$("#simple_description"),d=c.val(),e=$("#header_pack_name").val(),f=$("#header_description").val();if(m){""==b&&""!=e&&a.val(e);""==d&&""!=f&&c.val(f);B=$(".modules.tab-content-list > div:nth-child(1) #modules_description").val();a="behavior";switch($(".modules.tab-content-list > div:nth-child(1) #modules_type").val()){case "resources":a=
"texture";break;case "world_template":a="world";break;case "skin_pack":a="skin"}$(`input[type="radio"][name="simple_type_child"][value="${a}"]`).prop("checked",!0)}else a.val(""),c.val("")}$("#control_compact").on("click",function(a){l=a.target.checked});$("#format_version").on("change",function(){n=Number($("#format_version").val())});$(document).on("click",'input[type="button"].generate_uuid',function(){$(this).parents("div.type-uuid").find('input[type="text"]').val(H);L()});
function L(){m&&sa();ta();ua();va();z&&V();wa();C=xa();$("pre.language-json code.language-json").remove();$("pre.language-json").append($("<code>").addClass("language-json").text(C));var a=$("#header_pack_name").val(),b=$("#header_description").val();if(p)a=a.replace(/\s+|\\n/g," ").replace(/\u00a7[0-9a-gklmnor]/g,""),$("#ore-ui-card-title").text(a),$("#ore-ui-card-description").text(b.replace(/\s+|\\n/g," ").replace(/\u00a7[0-9a-gklmnor]/g,""));else{if(""==a)a="\u540d\u524d\u304c\u3042\u308a\u307e\u305b\u3093";
else if(null!=a.match(/\\/g)){a=a.split("\\\\");var c="";for(var d=0;d<a.length;d++){var e=a[d].indexOf("\\n");1<=d&&(c+="\\\\");if(-1!=e){c+=`${a[d].slice(0,a[d].indexOf("\\n")-a[d].length)+"\u2026"}`;break}else c+=`${a[d]}`}a=c}$("#card-title").text(a);if(""==b)b="\u00a7c\u4e0d\u660e\u306a\u30d1\u30c3\u30af\u306e\u8aac\u660e";else if(null!=b.match(/\\/g)){c=a=0;d="";b=b.split("\\\\");for(e=0;e<b.length;e++){do if(c++,a=b[e].indexOf("\\n",a+1),-1==a)break;while(3>c);1<=e&&(d+="\\\\");if(-1!=a){d+=
`${b[e].slice(0,a+1-b[e].length)+"\u2026"}`;break}else d+=`${b[e]}`}b=d}$("#card-description").text(b);MCFormat.formatAll()}Prism.highlightAll()}function wa(){z=!1;"number"===typeof y&&window.clearTimeout(y);y=window.setTimeout(function(){z=!0;V()},500)}
function ta(){r=$("#dependencies_enable").is(":checked")||$("#dependencies_enable").is(":indeterminate");t=$("#capabilities_enable").is(":checked")||$("#capabilities_enable").is(":indeterminate");u=$("#metadata_enable").is(":checked")||$("#metadata_enable").is(":indeterminate");v=$("#subpacks_enable").is(":checked")||$("#subpacks_enable").is(":indeterminate");var a=$(".dependencies.tab-content-list div.value-element");r?(a.find("div.value-label").removeClass("disabled"),a.find("input").prop("disabled",
!1),""==$("#dependencies_uuid").val()?$("#dependencies_enable").prop("indeterminate",!0):$("#dependencies_enable").prop("indeterminate",!1)):(a.find("div.value-label").addClass("disabled"),a.find("input").prop("disabled",!0));a=$(".capabilities_list .value-element");t?(a.removeClass("disabled"),a.find("input").prop("disabled",!1),$("div.capabilities_list div input").is(":checked")?$("#capabilities_enable").prop("indeterminate",!1):$("#capabilities_enable").prop("indeterminate",!0)):(a.addClass("disabled"),
a.find("input").prop("disabled",!0));a=$(".metadata_list .value-element");u?(a.removeClass("disabled"),a.find("input").prop("disabled",!1),[0<$(".metadata_author").length?""!=$(".metadata_author").val():!1,""!=$("#metadata_url").val(),""!=$("#metadata_license").val()].some(b=>b)?$("#metadata_enable").prop("indeterminate",!1):$("#metadata_enable").prop("indeterminate",!0)):(a.addClass("disabled"),a.find("input").prop("disabled",!0));a=$(".subpacks.tab-content-list div.value-element");v?(a.find("div.value-label").removeClass("disabled"),
a.find("input").prop("disabled",!1),""==$("#subpacks_folder_name").val()&&""==$("#subpacks_name").val()?$("#subpacks_enable").prop("indeterminate",!0):$("#subpacks_enable").prop("indeterminate",!1)):(a.find("div.value-label").addClass("disabled"),a.find("input").prop("disabled",!0))}
function ua(){[".dependencies",".subpacks"].forEach((a,b)=>{W(a,[[r,v][b],[r,v][b],[r,v][b]&&1<$(a+".tab-children").length])});1<$(".author_name").length?$(".remove_author").removeClass("disabled").find("input").prop("disabled",!1):$(".remove_author").addClass("disabled").find("input").prop("disabled",!0)}
function W(a="",b=[0,0,0]){[".tab-body",".add-tab",".remove-tab"].forEach((c,d)=>{c=$(a+c);1==b[d]?c.removeClass("disabled").find("input").prop("disabled",!1):0==b[d]&&c.addClass("disabled").find("input").prop("disabled",!0)})}
function va(){let a=Array.prototype.map.call($(".modules.tab-content-list > div #modules_type"),f=>f.value);w=a.some(f=>"world_template"==f);x=a.some(f=>"skin_pack"==f);$("#header_min_engine_version").toggleClass("disabled",w||x);$("#header_min_engine_version_input input").prop("disabled",w||x);$("#header_base_game_version").toggleClass("disabled",2<=n&&!w);$("#header_base_game_version_input input").prop("disabled",2<=n&&!w);$("#header_lock_template_options").prop("disabled",!w).parent().toggleClass("disabled",
!w);$("#header_pack_scope_label").toggleClass("disabled",w||x);$("#header_pack_scope").prop("disabled",w||x);let b=[!1,!1,!1,!1,!1,!1,!1,!1,!1];const c={data:0,resources:1,client_data:2,script:3,["interface"]:4,world_template:5,skin_pack:6,javascript:7,plugin:8};let d=w||x||a.some(f=>"resources"==f);F=[];for(let f=0;f<a.length;f++){const g=$(`.modules.tab-content-list > div:nth-child(${f+1})`),k=g.find(" #modules_type");b.forEach((za,Aa)=>{k.find(`option:nth-child(${Aa+1})`).prop("disabled",za)});
if(b[c[a[f]]]){var e=b.indexOf(!1);if(-1==e){F.push(f);continue}k.prop("selectedIndex",e);a[f]=k.val()}let X,Y;(X=b)[Y=c[a[f]]]||(X[Y]=!0);e="script"==a[f]||"javascript"==a[f]||"plugin"==a[f];let Z,aa;(Z=b)[aa=c.script]||(Z[aa]=e);let ba,ca;(ba=b)[ca=c.javascript]||(ba[ca]=e);let da,ea;(da=b)[ea=c.plugin]||(da[ea]=e);let fa,ha;(fa=b)[ha=c.resources]||(fa[ha]=!0);let ia,ja;(ia=b)[ja=c.world_template]||(ia[ja]=!0);let ka,la;(ka=b)[la=c.skin_pack]||(ka[la]=!0);g.find("#modules_language_label").toggleClass("disabled",
!e);g.find("#modules_language").prop("disabled",!e);g.find("#modules_entry_label").toggleClass("disabled",!e);g.find("#modules_entry").prop("disabled",!e);d&&b.fill(!0)}d?W(".modules",[!1,0,0]):W(".modules",[!0,b.some(f=>0==f),a.length-1])}
function V(){const a=new pa;let b=$("#header_min_engine_version_major"),c=b.val();switch(n){case 1:(1<c||13<=Number($("#header_min_engine_version_minor").val()))&&I(a,"[Header:min engine version] \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30d0\u30fc\u30b8\u30e7\u30f31\u3067\u306f1.13\u3088\u308a\u4f4e\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3088\u308a\u9ad8\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30d0\u30fc\u30b8\u30e7\u30f32\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002",b.parent().find("input"));
break;case 2:1>=c&&13>Number($("#header_min_engine_version_minor").val())&&J(a,"[Header:min engine version] version1.12\u4ee5\u4e0b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002",b.parent().find("input")),1>=Number($("#header_base_game_version_major").val())&&13>Number($("#header_base_game_version_minor").val())&&J(a,"[Header:base game version] version1.12\u4ee5\u4e0b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002",$("#header_base_game_version_major").parent().find("input"))}b=
$("#header_pack_name");c=b.val();""==c?I(a,'[Header:name] \u540d\u524d\u304c\u7a7a\u3067\u3059\u3002\u540d\u524d\u304c\u7a7a\u306e\u5834\u5408\u3001"\u540d\u524d\u304c\u3042\u308a\u307e\u305b\u3093"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002',b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&J(a,'[Header:name] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',
b);b=$("#header_description");c=b.val();""==c?I(a,'[Header:description] \u8aac\u660e\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u8aac\u660e\u304c\u7a7a\u306e\u5834\u5408\u3001"\u4e0d\u660e\u306a\u30d1\u30c3\u30af\u306e\u8aac\u660e"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002',b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&J(a,'[Header:description] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',
b);b=$("#header_uuid");c=b.val();""==c?J(a,"[Header:uuid] UUID\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",b):K(c)||J(a,"[Header:uuid] \u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002",b);var d=$(".modules.tab-children").length;for(let g=0;g<d;g++)if(!F.some(k=>k==g)){var e=g+1;b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_type`);var f=b.val();
null==f&&J(a,`[Modules:${g}:type] ${"type\u304cnull\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002type\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}`,b);"javascript"!=f&&"plugin"!=f||I(a,`[Modules:${g}:type] ${'"%s"\u306f\u904e\u53bb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305ftype\u3067\u3059\u3002\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002"script"\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002'.split(/%s/).join(f)}`,
b);b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_description`);c=b.val();""==c?I(a,`[Modules:${g}:description] ${"\u8aac\u660e\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}`,b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&J(a,`[Modules:${g}:description] ${'\u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002'}`,b);b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_uuid`);
c=b.val();""==c?J(a,`[Modules:${g}:uuid] ${"UUID\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}`,b):K(c)||J(a,`[Modules:${g}:uuid] ${"\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"}`,b);if("script"==f||"javascript"==f||"plugin"==f)b=$(`.modules.tab-content-list > div:nth-child(${e}) #modules_entry`),c=b.val(),""==c?J(a,`[Modules:${g}:entry] ${"\u30d7\u30e9\u30a4\u30de\u30ea\u30d5\u30a1\u30a4\u30eb\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093"}`,
b):c.match(/\.js$/)||J(a,`[Modules:${g}:entry] ${"\u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f .js \u306e\u62e1\u5f35\u5b50\u3092\u6301\u3063\u3066\u3044\u307e\u305b\u3093\u3002 \u30d7\u30e9\u30a4\u30de\u30ea\u30d5\u30a1\u30a4\u30eb\u306fJavaScript\u30d5\u30a1\u30a4\u30eb\u4ee5\u5916\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u305b\u3093\u3002"}`,b)}if(r)for(d=$(".dependencies.tab-children").length,e=0;e<d;e++)b=$(`div.dependencies.tab-content-list > div:nth-child(${e+1}) #dependencies_uuid`),
c=b.val(),""==c?I(a,`[Dependencies:${e}:uuid/module_name] ${"UUID/\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u304c\u7a7a\u3067\u3059\u3002UUID\u3092\u6307\u5b9a\u3059\u308b\u304b\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}`,b):ma.some(g=>g==c)||K(c)||I(a,`[Dependencies:${e}:uuid/module_name] ${"\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u306f\u6709\u52b9\u306aUUID/\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"}`,
b);t&&($("#experimental_custom_ui").is(":checked")||$("#chemistry").is(":checked")||$("#raytraced").is(":checked")||$("#script_eval").is(":checked")||$("#editorExtension").is(":checked")||I(a,"[Capabilities] \u4e00\u3064\u3082\u9805\u76ee\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",$(".capabilities_list>input")));if(u){if(d=$("label.author_name").length)for(e=0;e<d;e++)b=$("input.metadata_author").eq(e),c=b.val(),""==c?I(a,`[Metadata:author:${e}] ${"\u540d\u524d\u304c\u7a7a\u3067\u3059\u3002"}`,
b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&J(a,`[Metadata:author:${e}] ${'\u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002'}`,b);else I(a,"[Metadata:author] \u540d\u524d\u304c\u4e00\u3064\u3082\u3042\u308a\u307e\u305b\u3093\u3002",$("div.add_author"));b=$("#metadata_url");c=b.val();""==c?I(a,"[Metadata:url] URL\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",
b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&J(a,'[Metadata:url] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',b);b=$("#metadata_license");c=b.val();""==c?I(a,"[Metadata:license] \u30e9\u30a4\u30bb\u30f3\u30b9\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",b):"\\"==c.toString().replace(/\\\\/g,"").slice(-1)&&
J(a,'[Metadata:license] \u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002',b)}if(v)for(d=$(".subpacks.tab-children").length,e=0;e<d;e++)f=$(`div.subpacks.tab-content-list > div:nth-child(${e+1})`),b=f.find("#subpacks_folder_name"),""==b.val()&&J(a,`[Subpacks:${e}:folder_name] ${"\u30d5\u30a9\u30eb\u30c0\u30fc\u540d\u304c\u7a7a\u3067\u3059\u3002"}`,
b),b=f.find("#subpacks_name"),c=b.val().toString(),""==c?J(a,`[Subpacks:${e}:name] ${"\u540d\u524d\u304c\u7a7a\u3067\u3059\u3002"}`,b):"\\"==c.replace(/\\\\/g,"").slice(-1)&&J(a,`[Subpacks:${e}:name] ${'\u6700\u5f8c\u306e\u6587\u5b57\u304c\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5"\\"\u3067\u3059\u3002\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u306b\u3059\u308b\u304b\u6d88\u53bb\u3057\u3066\u304f\u3060\u3055\u3044\u3002'}`,b);oa(a)}
function ya(a="",b=""){let c="\u6709\u52b9\u306ajson\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";if(""==a||""==b)return c;const d=b.split(" "),e=d.findIndex(g=>"line"==g),f=d.findIndex(g=>"position"==g);b=a.split(/\n/g);-1!=e?(a=parseInt(d[e+1],10),c+=`\n${a}\u884c\u76ee\u3067\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n${b.slice(a-2,a+1).join("\n")}`):-1!=f&&(a=a.substring(0,d[f+1]).match(/\n/g)?.length+1??1,c+=`\n${a}\u884c\u76ee\u3067\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n${b.slice(a-
2,a+1).join("\n")}`);return c}
async function Q(a=""){var b={};try{b=JSON.parse(a)}catch(g){if(a.match(/\/\*[\s\S]*?\*\/ | \/\/(?=.*)(?!.*(",|")).*/g)&&window.confirm(`${ya(a,g.message)}\n\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u9664\u53bb\u3057\u3066\u518d\u8a66\u884c\u3057\u307e\u3059\u304b\uff1f\n`)){a=a.replace(/\/\*[\s\S]*?\*\/ | \/\/(?=.*)(?!.*(",|")).*/g,"");try{b=JSON.parse(a)}catch(k){window.alert(ya(a,k.message)),console.error("error:"+k)}}else console.error("error:"+g)}if(b?.format_version)$("#format_version").val(b.format_version);else if(b?.header?.modules){window.alert("\u53e4\u3044\u5f62\u5f0f(pack_manifest.json)\u304b\u3089\u5909\u63db\u3057\u307e\u3059\u3002");
b=b.header;$("#header_pack_name").val(b?.name??"");$("#header_description").val(b?.description??"");$("#header_uuid").val(b?.pack_id??"");$("#header_version").val(b?.packs_version??"1.0.0");if(null!=b.modules)for(var c=0;c<b.modules.length;c++){0<c&&N("modules");var d=b.modules[c];a=$(`.modules.tab-content-list > div:nth-child(${c+1})`);a.find("#modules_type").val(d?.type??"data");a.find("#modules_description").val(d?.description??"");var e=(d?.version??"1.0.0").split(".");a.find("#modules_version_major").val(e?.[0]??
1);a.find("#modules_version_minor").val(e?.[1]??0);a.find("#modules_version_patch").val(e?.[2]??0);a.find("#modules_uuid").val(d?.uuid??"")}if(null!=b.dependencies)for($("#dependencies_enable").prop("checked",!0),c=0;c<b.dependencies.length;c++)0<c&&N("dependencies"),d=b.dependencies[c],$(`div.dependencies.tab-content-list > div:nth-child(${c+1})`).find("#dependencies_uuid").val(d?.uuid??""),d=(d?.version??"1.0.0").split("."),$("#dependencies-version").val(d??"1.0.0");L();return}$("#header_pack_name").val(b.header?.name??
"");$("#header_description").val(b.header?.description??"");"string"==typeof b.header?.version?$("#header_version").val(b.header?.version):Array.isArray(b.header?.version)?$("#header_version").val(b.header?.version.join(".")):$("#header_version").val("1.0.0");$("#header_min_engine_version_major").val(b.header?.min_engine_version?.[0]??1);$("#header_min_engine_version_minor").val(b.header?.min_engine_version?.[1]??13);$("#header_min_engine_version_patch").val(b.header?.min_engine_version?.[2]??0);
$("#header_uuid").val(b.header?.uuid??"");$("#header_platform_locked").prop("checked",b.header?.platform_locked??!1);$("#header_base_game_version_major").val(b.header?.base_game_version?.[0]??1);$("#header_base_game_version_minor").val(b.header?.base_game_version?.[1]??13);$("#header_base_game_version_patch").val(b.header?.base_game_version?.[2]??0);$("#header_lock_template_options").prop("checked",b.header?.lock_template_options??!1);$("#header_pack_scope").val(b.header?.pack_scope??"none");if(b?.modules)for(a=
0;a<b.modules.length;a++){0<a&&N("modules");e=b.modules[a];var f=$(`.modules.tab-content-list > div:nth-child(${a+1})`);f.find("#modules_type").val(e?.type??"data");f.find("#modules_description").val(e?.description??"");f.find("#modules_version_major").val(e?.version?.[0]??1);f.find("#modules_version_minor").val(e?.version?.[1]??0);f.find("#modules_version_patch").val(e?.version?.[2]??0);f.find("#modules_uuid").val(e?.uuid??"");f.find("#modules_language").val(e?.language??"javascript");f.find("#modules_entry").val(e?.entry??
"")}if(b?.dependencies)for($("#dependencies_enable").prop("checked",!0),a=0;a<b.dependencies.length;a++)0<a&&N("dependencies"),e=b.dependencies[a],f=$(`div.dependencies.tab-content-list > div:nth-child(${a+1})`),f.find("#dependencies_uuid").val(e?.uuid??e?.module_name??""),"string"==typeof e?.version?f.find("#dependencies-version").val(e?.version):Array.isArray(e?.version)?f.find("#dependencies-version").val(e?.version.join(".")):f.find("#dependencies-version").val("1.0.0-e");if(b?.capabilities){$("#capabilities_enable").prop("checked",
!0);for(d of b.capabilities)switch(d){case "experimental_custom_ui":$("#experimental_custom_ui").prop("checked",!0);break;case "chemistry":$("#chemistry").prop("checked",!0);break;case "raytraced":$("#raytraced").prop("checked",!0);break;case "script_eval":$("#script_eval").prop("checked",!0);break;case "editorExtension":$("#editorExtension").prop("checked",!0)}}if(b?.metadata){d=b.metadata;G=d?.generated_with;a=!1;if(d?.authors){for(c of d.authors)O(c);a||=!0}d?.url&&(a||=!0);$("#metadata_url").val(d?.url??
"");d?.license&&(a||=!0);$("#metadata_license").val(d?.license??"");$("#metadata_enable").prop("checked",a)}if(b?.subpacks)for($("#subpacks_enable").prop("checked",!0),c=0;c<b.subpacks.length;c++)0<c&&N("subpacks"),d=b.subpacks[c],a=$(`div.subpacks.tab-content-list > div:nth-child(${c+1})`),a.find("#subpacks_folder_name").val(d?.folder_name??""),a.find("#subpacks_name").val(d?.name??""),a.find("#subpacks_memory_tier").val(d?.memory_tier??0);U();L()}
function xa(){const a=new na;let b={};b.format_version=n;b.header={};b.header.name=a.register($("#header_pack_name").val());b.header.description=a.register($("#header_description").val());var c=$("#header_version").val();(new RegExp(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/)).test(c)?b.header.version=a.register(c.split(/\./).map(g=>Number(g))):(new RegExp(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/)).test(c)?
b.header.version=c:b.header.version=a.register([1,0,0]);b.header.uuid=$("#header_uuid").val();b.header.platform_locked=$("#header_platform_locked").is(":checked")?!0:void 0;w?(2<=n&&(b.header.base_game_version=a.register([Number($("#header_base_game_version_major").val()),Number($("#header_base_game_version_minor").val()),Number($("#header_base_game_version_patch").val())])),b.header.lock_template_options=$("#header_lock_template_options").is(":checked")):x||(b.header.min_engine_version=a.register([Number($("#header_min_engine_version_major").val()),
Number($("#header_min_engine_version_minor").val()),Number($("#header_min_engine_version_patch").val())]),b.header.pack_scope="none"!=$("#header_pack_scope").val()?$("#header_pack_scope").val():void 0);b.modules=[];c=$(".modules.tab-children").length;for(let g=0;g<c;g++)if(!F.some(k=>k==g)){var d=$(`.modules.tab-content-list > div:nth-child(${g+1})`),e=d.find("#modules_type").val();null!=e&&void 0!=e&&(b.modules[g]={},b.modules[g].type=e,b.modules[g].description=a.register(d.find("#modules_description").val()),
b.modules[g].version=a.register([Number(d.find("#modules_version_major").val()),Number(d.find("#modules_version_minor").val()),Number(d.find("#modules_version_patch").val())]),b.modules[g].uuid=d.find("#modules_uuid").val(),b.modules[g].language="script"==e||"javascript"==e?a.register(d.find("#modules_language").val()):void 0,b.modules[g].entry="script"==e||"javascript"==e||"plugin"==e?a.register(d.find("#modules_entry").val()):void 0)}if(r)for(b.dependencies=[],c=$(".dependencies.tab-children").length,
d=0;d<c;d++){e=$(`div.dependencies.tab-content-list > div:nth-child(${d+1})`);b.dependencies[d]={};let g=e.find("#dependencies_uuid").val();K(g)?b.dependencies[d].uuid=g:b.dependencies[d].module_name=g;e=e.find("#dependencies-version").val();(new RegExp(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/)).test(e)?b.dependencies[d].version=a.register(e.split(/\./).map(k=>Number(k))):(new RegExp(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/)).test(e)?
b.dependencies[d].version=e:b.dependencies[d].version=a.register([1,0,0])}t&&$("div.capabilities_list div input").is(":checked")&&(b.capabilities=[],$("#experimental_custom_ui").is(":checked")&&b.capabilities.push("experimental_custom_ui"),$("#chemistry").is(":checked")&&b.capabilities.push("chemistry"),$("#raytraced").is(":checked")&&b.capabilities.push("raytraced"),$("#script_eval").is(":checked")&&b.capabilities.push("script_eval"),$("#editorExtension").is(":checked")&&b.capabilities.push("editorExtension"));
b.metadata={};if(u){const g=$("input.metadata_author");if((()=>{for(let k=0;k<g.length;k++)if(""!=g.eq(k).val())return!0;return!1})())for(b.metadata.authors=[],c=0;c<g.length;c++)b.metadata.authors.push(a.register(g.eq(c).val()));""!=$("#metadata_url").val()&&(b.metadata.url=a.register($("#metadata_url").val()));""!=$("#metadata_license").val()&&(b.metadata.license=a.register($("#metadata_license").val()))}b.metadata.generated_with={};G["TokaTools-Manifest-Generator"]=Array.from((new Set([...(G["TokaTools-Manifest-Generator"]??
[])])).add("1.8.0"));for(var f in G)b.metadata.generated_with[f]=a.register(G[f]);if(v)for(b.subpacks=[],f=$(".subpacks.tab-children").length,c=0;c<f;c++)d=c+1,b.subpacks[c]={},e=$(`div.subpacks.tab-content-list > div:nth-child(${d})`),b.subpacks[c].folder_name=e.find("#subpacks_folder_name").val(),b.subpacks[c].name=a.register($(`div.subpacks.tab-content-list > div:nth-child(${d}) #subpacks_name`).val()),b.subpacks[c].memory_tier=Number(e.find("#subpacks_memory_tier").val());return a.replaceAll(JSON.stringify(b,
void 0,l?void 0:"  "),l)}
function sa(){const a=$("#simple_pack_name").val();var b=$("#simple_description").val(),c=$("#header_pack_name"),d=$("#header_description");c.val(a);d.val(b);b=$("#header_uuid");""==b.val()&&(b.val(H()),h=!0);b=$(".modules.tab-children").length;for(c=0;c<b;c++){d=$(`.modules.tab-content-list > div:nth-child(${c+1})`);var e=d.find("#modules_type");let f="data",g="behavior";switch($('input[type="radio"][name="simple_type_child"]:checked').val()){case "behavior":f="data";g="behavior";break;case "texture":g=
f="resources";break;case "world":f="world_template";g="world template";break;case "skin":f="skin_pack",g="skin pack"}e.val()!=f&&(B="");e.val(f);e=d.find("#modules_description");""==B&&(e.val(`${[a.replace(/\u00a7.|\\n/g,""),g].filter(k=>k).join(" ")} module`),h=!0);d=d.find("#modules_uuid");""==d.val()&&(d.val(H()),h=!0)}};
